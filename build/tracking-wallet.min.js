/*! tracking-wallet - v0.0.1 - 2016-01-20 */"use strict";!function(a,b){var c=function(a){this.levelLogger=a};c.prototype.debug=function(b){this.levelLogger>=3&&a&&a.console&&a.console.debug&&a.console.debug(b)},c.prototype.info=function(b){this.levelLogger>=2&&a&&a.console&&a.console.info&&a.console.info(b)},c.prototype.warn=function(b){this.levelLogger>=1&&a&&a.console&&a.console.warn&&a.console.warn(b)},c.prototype.error=function(b){this.levelLogger>=0&&a&&a.console&&a.console.error&&a.console.error(b)};var d=function(){};d.getId=function(){function a(){return Math.random().toString(16).slice(-4)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};var e=function(){};e.getMixpanelCookie=function(){if(document.cookie.length>0){var a=document.cookie.match(/mp_\w*_mixpanel/g);if(a&&a.length>0){var b=e.get(a[0]);return JSON.parse(b)}}return null},e.get=function(b){if(document.cookie.length>0){var c=document.cookie.indexOf(b+"=");if(-1!==c){c=c+b.length+1;var d=document.cookie.indexOf(";",c);return-1===d&&(d=document.cookie.length),a.unescape(document.cookie.substring(c,d))}}return null},e.set=function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"};var f={prefixNameTrakingData:"data-tw-",nameTrackingEventData:"data-tw-event",preTextLogger:"TR-W",pageViewEvent:"Page view",clickEvent:"click",submitEvent:"submit",defaultTimeout:300,cookieFirst:"CW-FirstTime"},g={},h=null,i={},j=function(a){if(a!==f.prefixNameTrakingData+"event"){var b=a.replace(f.prefixNameTrakingData,"");return b=b.replace("-"," "),k(b)}return a.replace(f.prefixNameTrakingData,"")},k=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},l=function(a){var b,c,d=a[0].attributes,e=null,g={};for(c=0,b=d.length;b>c;c++)e=d[c],0===e.name.indexOf(f.prefixNameTrakingData)&&(g[j(e.name)]=e.value);return g},m=function(a,b){a[0].click(),setTimeout(function(){a.on("click",b)},200)},n=function(a){if(a.attr("id"))return a.attr("id");var b=d.getId();return a.attr("id","tw-"+b),"tw-"+b},o=function(b,c){if("a"===b.prop("tagName").toLowerCase())a.mixpanel.track_links("#"+n(b),k(f.clickEvent),c),h.debug("Bind event click in "+n(b));else{var d=function(e){e.preventDefault(),b.unbind("click",d),setTimeout(function(){m(b,d)},f.defaultTimeout),a.mixpanel.track(k(f.clickEvent),c)};b.on("click",d)}},p=function(a){var c={};return b.each(a.find("input, select"),function(a,d){b(d).data("tw-name")&&(c[b(d).data("tw-name")]=b(d).val())}),c},q=function(c,d){"form"===c.prop("tagName").toLowerCase()?a.mixpanel.track_forms("#"+n(c),k(f.submitEvent),function(){var a=p(c);return b.extend({},d,a)}):console.error("submit event if only allowed in form tags")},r=function(a){var c=l(a);if(c=b.extend({},g,c),c.event){var d=c.event;switch(delete c.event,d){case f.clickEvent:o(a,c);break;case f.submitEvent:q(a,c);break;default:console.warn("Event not found! ("+d+")")}}else h.error("Element has not defined event attribute")},s=function(){var a,c=null,d=b("["+f.nameTrackingEventData+"]");if(d&&d.length>0)for(a=d.length,c=0;a>c;c++)r(b(d[c]))},t=function(){h.debug("Sending page view event");var c=b("body"),d=l(c);g=d,a.mixpanel.track(f.pageViewEvent,d)},u=function(a,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+b+"=([^&#]*)",d=new RegExp(c),e=d.exec(a);return null===e||e&&"string"!=typeof e[1]&&e[1].length?"":decodeURIComponent(e[1]).replace(/\+/g," ")},v=function(a,b){return a&&a.indexOf(b)>=0},w=function(){var a=document.referrer;return v(a,"google")||v(a,"bing")||v(a,"yahoo")?!0:!1},x=function(){var a=document.referrer;return v(a,"facebook")||v(a,"twitter")||v(a,"plus.google")||v(a,"linkedin")||v(a,"pinterest")||v(a,"instagram")?!0:!1},y=function(){var a=document.referrer;return x()||w()||!a?!1:!0},z=function(){return y()?!1:!0},A=function(){var a=u(document.URL,"utm_medium");return a?a:x()?"social":w()?"seo":y()?"referral":z()?"direct":void 0},B=function(a){var b=a.split("_");return b.length>1?b[0].toUpperCase()+" "+k(b[1]):k(a)},C=function(){var a,b="utm_source utm_medium utm_campaign utm_content utm_term state".split(" "),c="",d={};for(a=0;a<b.length;++a)c=u(document.URL,b[a]),c.length&&(d["Last "+B(b[a])]=c);return d["Last Referrer"]=document.referrer,d["Last URL"]=document.URL,d["Last Touch Source"]=A(),d},D=function(){var a={};return a["UTM Term"]=u(document.URL,"utm_term"),a["First state"]=u(document.URL,"state"),a["First Referrer"]=document.referrer,a["First URL"]=document.URL,a["First Touch Source"]=A(),a},E=function(){var c={};e.get(f.cookieFirst)||(c=b.extend(c,D()),e.set(f.cookieFirst,!0,365)),h.debug("Obtaining params last"),c=b.extend(c,C()),a.mixpanel.people.set(c),a.mixpanel.register(c)},F=function(){h.debug("Starting tracking");try{(!document.referrer||document.referrer.indexOf(i.ownerDomain)<0)&&E(),t(),s()}catch(a){console.error(a)}},G=function(d){if(i=d,void 0===b)throw new Error("Jquery not load");if(void 0===a.mixpanel)throw new Error("window.Mixpanel not load");var e=0;b("body").data("env")&&"production"!==b("body").data("env").toLowerCase()&&(e=3),h=new c(e),a.mixpanel.set_config({debug:3===e}),F()},H=function(c,d){var e=b.extend({},g,d);a.mixpanel.track(c,e)},I=function(b){a.mixpanel.identify(b)},J=function(b,c){a.mixpanel.alias(b,c)},K=function(b){a.mixpanel.people.set(b)};a.trackingWallet={init:G,track:H,extractDataForm:p,getMixpanelCookie:e.getMixpanelCookie,identify:I,alias:J,people:{set:K}}}(window,jQuery);